



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>R - HPC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/unibe.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#r" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="HPC Documentation" aria-label="HPC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              HPC Documentation
            </span>
            <span class="md-header-nav__topic">
              
                R
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hpc-unibe-ch/hpc-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hpc-unibe-ch/hpc-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="HPC Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    HPC Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hpc-unibe-ch/hpc-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hpc-unibe-ch/hpc-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../code-of-conduct.html" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started.html" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../account-activation-login.html" title="Account Activation and Login" class="md-nav__link">
      Account Activation and Login
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../file-transfer.html" title="File Transfer" class="md-nav__link">
      File Transfer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Job Management with Slurm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Job Management with Slurm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/submission.html" title="Job Submission" class="md-nav__link">
      Job Submission
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/monitoring-jobs.html" title="Monitoring Jobs" class="md-nav__link">
      Monitoring Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/deleting-jobs.html" title="Deleting Jobs" class="md-nav__link">
      Deleting Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/array-jobs.html" title="Array Jobs with Slurm" class="md-nav__link">
      Array Jobs with Slurm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/gpus.html" title="GPUs" class="md-nav__link">
      GPUs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/interactive-jobs.html" title="Interactive Jobs" class="md-nav__link">
      Interactive Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/investigating-job-failure.html" title="Investigating a Job Failure" class="md-nav__link">
      Investigating a Job Failure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-management/checkpointing.html" title="Checkpointing" class="md-nav__link">
      Checkpointing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" checked>
    
    <label class="md-nav__link" for="nav-4-5">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="pre-installed-software.html" title="Pre-Installed Software" class="md-nav__link">
      Pre-Installed Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="installing-custom-software.html" title="Installing Custom Software" class="md-nav__link">
      Installing Custom Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="terminal-multiplexer-tmux.html" title="Terminal Multiplexer (tmux)" class="md-nav__link">
      Terminal Multiplexer (tmux)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="matlab.html" title="Matlab" class="md-nav__link">
      Matlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="python.html" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="JupyterLab.html" title="JupyterLab" class="md-nav__link">
      JupyterLab
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        R
      </label>
    
    <a href="r.html" title="R" class="md-nav__link md-nav__link--active">
      R
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-topics" class="md-nav__link">
    Basic Topics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-the-workspace" class="md-nav__link">
    Customizing the Workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-packages" class="md-nav__link">
    Installing Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-execution-of-r" class="md-nav__link">
    Batch Execution of R
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    Advanced Topics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-r" class="md-nav__link">
    Parallel R
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-deseq2-from-bioconductor-packages" class="md-nav__link">
    Installing DESeq2 from Bioconductor packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="relion.html" title="Relion" class="md-nav__link">
      Relion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="singularity.html" title="Singularity" class="md-nav__link">
      Singularity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../file-system-quota.html" title="File System Quota" class="md-nav__link">
      File System Quota
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faq.html" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../halloffame.html" title="Hall of Fame" class="md-nav__link">
      Hall of Fame
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-topics" class="md-nav__link">
    Basic Topics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-the-workspace" class="md-nav__link">
    Customizing the Workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-packages" class="md-nav__link">
    Installing Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-execution-of-r" class="md-nav__link">
    Batch Execution of R
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    Advanced Topics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-r" class="md-nav__link">
    Parallel R
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-deseq2-from-bioconductor-packages" class="md-nav__link">
    Installing DESeq2 from Bioconductor packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="r">R</h1>
<h2 id="description">Description</h2>
<p>UBELIX no longer features the R version from EPEL as this version gets automatically updated and therefore things are not reproducible. R isn now provided by an environment module and must be loaded explicitly:</p>
<div class="codehilite"><pre><span></span><code>module load R/3.4.4-foss-2018a-X11-20180131

-bash-4.1$ R --version
R version <span class="m">3</span>.4.4 <span class="o">(</span><span class="m">2018</span>-03-15<span class="o">)</span> -- <span class="s2">&quot;Someone to Lean On&quot;</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2018</span> The R Foundation <span class="k">for</span> Statistical Computing
Platform: x86_64-pc-linux-gnu <span class="o">(</span><span class="m">64</span>-bit<span class="o">)</span>

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the
GNU General Public License versions <span class="m">2</span> or <span class="m">3</span>.
For more information about these matters see
http://www.gnu.org/licenses/.
</code></pre></div>

<p>The <strong>Vital-IT project</strong> is also providing some versions. The following commands will list the available versions:</p>
<div class="codehilite"><pre><span></span><code>module load vital-it
module avail <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot; R\/&quot;</span>
  R/3.4.2
  R/latest
</code></pre></div>

<p>To use one of these version, you have to load the respective module, which then masks the system&rsquo;s version, i.e.</p>
<div class="codehilite"><pre><span></span><code>module load vital-it
module load R/3.4.2
</code></pre></div>

<div class="admonition types danger">
<p>Do not forget to put those two lines into your job script as well in order to use the same version from within the job later on a compute node!</p>
</div>
<h2 id="basic-topics">Basic Topics</h2>
<h3 id="customizing-the-workspace">Customizing the Workspace</h3>
<p>At startup, unless &ndash;no-init-file, or &ndash;vanilla was given, R searches for a user profile in the current directory (from where R was started), or in the user&rsquo;s home directory (in that order). A different path of the user profile file can be specified by the R_PROFILE_USER environment variable. The found user profile is then sourced into the workspace. You can use this file to customize your workspace, i.e., to set specific options, define functions, load libraries, and so on. Consider the following example:</p>
<p><strong>.Rprofile</strong>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set some options</span>
options<span class="o">(</span><span class="nv">stringsAsFactors</span><span class="o">=</span>FALSE<span class="o">)</span>
options<span class="o">(</span>max.print<span class="o">=</span><span class="m">100</span><span class="o">)</span>
options<span class="o">(</span><span class="nv">scipen</span><span class="o">=</span><span class="m">10</span><span class="o">)</span>

<span class="c1"># Load  class library</span>
library<span class="o">(</span>class<span class="o">)</span>

<span class="c1"># Don&#39;t save workspace by default</span>
q &lt;- <span class="k">function</span> <span class="o">(</span><span class="nv">save</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>, ...<span class="o">)</span> <span class="o">{</span>
  quit<span class="o">(</span><span class="nv">save</span><span class="o">=</span>save, ...<span class="o">)</span>
<span class="o">}</span>

<span class="c1"># User-defined function for setting standard seed</span>
mySeed &lt;- <span class="k">function</span><span class="o">()</span> set.seed<span class="o">(</span><span class="m">5450</span><span class="o">)</span>


<span class="c1"># User-defined function for calculating L1/L2-norm, returns euclidian distance (L2-norm) by default</span>
myDistance &lt;- <span class="k">function</span><span class="o">(</span>x, y, <span class="nv">type</span><span class="o">=</span>c<span class="o">(</span><span class="s2">&quot;Euclidian&quot;</span>, <span class="s2">&quot;L2&quot;</span>, <span class="s2">&quot;Manhattan&quot;</span>, <span class="s2">&quot;L1&quot;</span><span class="o">))</span> <span class="o">{</span>
  <span class="nb">type</span> &lt;- match.arg<span class="o">(</span><span class="nb">type</span><span class="o">)</span>
  <span class="k">if</span> <span class="o">((</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Manhattan&quot;</span><span class="o">)</span> <span class="p">|</span> <span class="o">(</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;L1&quot;</span><span class="o">))</span> <span class="o">{</span>
    d &lt;- sum<span class="o">(</span> abs<span class="o">(</span>x - y<span class="o">)</span> <span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    d &lt;- sqrt<span class="o">(</span> sum<span class="o">(</span> <span class="o">(</span>x - y<span class="o">)</span> ^ <span class="m">2</span><span class="o">)</span> <span class="o">)</span>
  <span class="o">}</span>
  <span class="k">return</span><span class="o">(</span>d<span class="o">)</span>
<span class="o">}</span>
</code></pre></div></p>
<h3 id="installing-packages">Installing Packages</h3>
<p>Run R interactively. To install additional R packages call the install.packages() function with the name of the package as argument. Upon installing the first package, you will receive a warning that you do not have sufficient permissions to write to &ldquo;/usr/lib64/R/library&rdquo;. Type &ldquo;y&rdquo; to use a personal library instead:</p>
<div class="codehilite"><pre><span></span><code>&gt; install.packages<span class="o">(</span><span class="s2">&quot;doParallel&quot;</span><span class="o">)</span>
Installing package into ‘/usr/lib64/R/library’
<span class="o">(</span>as ‘lib’ is unspecified<span class="o">)</span>
Warnung in install.packages<span class="o">(</span><span class="s2">&quot;doParallel&quot;</span><span class="o">)</span>
  <span class="err">&#39;</span><span class="nv">lib</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib64/R/library&quot;</span> ist nicht schreibbar
Would you like to use a personal library instead?  <span class="o">(</span>y/n<span class="o">)</span>
</code></pre></div>

<p>Next, type &ldquo;y&rdquo; to create your personal library at the default location within your HOME directory:</p>
<div class="codehilite"><pre><span></span><code>Would you like to create a personal library
~/R/x86_64-redhat-linux-gnu-library/3.4
</code></pre></div>

<p>Next, select a CRAN mirror to download from. The mirrorlist will be not the same as below. The mirrolist is constantly changing, but will look like it.</p>
<p>Pick any country nearby, i.e. Switzerland. If https makes problems, pick &ldquo;(HTTP mirrors)&rdquo; and then select something nearby as shown below</p>
<div class="codehilite"><pre><span></span><code>--- Bitte einen CRAN Spiegel für diese Sitzung auswählen ---
Error in download.file<span class="o">(</span>url, <span class="nv">destfile</span> <span class="o">=</span> f, <span class="nv">quiet</span> <span class="o">=</span> TRUE<span class="o">)</span> :
  nicht unterstütztes URL Schema
HTTPS CRAN mirror
 <span class="m">1</span>: <span class="m">0</span>-Cloud <span class="o">[</span>https<span class="o">]</span>                <span class="m">2</span>: Austria <span class="o">[</span>https<span class="o">]</span>
 <span class="m">3</span>: Chile <span class="o">[</span>https<span class="o">]</span>                  <span class="m">4</span>: China <span class="o">(</span>Beijing <span class="m">4</span><span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
 <span class="m">5</span>: Colombia <span class="o">(</span>Cali<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>        <span class="m">6</span>: France <span class="o">(</span>Lyon <span class="m">2</span><span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
 <span class="m">7</span>: France <span class="o">(</span>Paris <span class="m">2</span><span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>       <span class="m">8</span>: Germany <span class="o">(</span>Münster<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
 <span class="m">9</span>: Iceland <span class="o">[</span>https<span class="o">]</span>               <span class="m">10</span>: Mexico <span class="o">(</span>Mexico City<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">11</span>: Russia <span class="o">(</span>Moscow<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>       <span class="m">12</span>: Spain <span class="o">(</span>A Coruña<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">13</span>: Switzerland <span class="o">[</span>https<span class="o">]</span>           <span class="m">14</span>: UK <span class="o">(</span>Bristol<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">15</span>: UK <span class="o">(</span>Cambridge<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>        <span class="m">16</span>: USA <span class="o">(</span>CA <span class="m">1</span><span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">17</span>: USA <span class="o">(</span>KS<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>              <span class="m">18</span>: USA <span class="o">(</span>MI <span class="m">1</span><span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">19</span>: USA <span class="o">(</span>TN<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>              <span class="m">20</span>: USA <span class="o">(</span>TX<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>
<span class="m">21</span>: USA <span class="o">(</span>WA<span class="o">)</span> <span class="o">[</span>https<span class="o">]</span>              <span class="m">22</span>: <span class="o">(</span>HTTP mirrors<span class="o">)</span>

Selection: <span class="m">22</span>
HTTP CRAN mirror
 <span class="m">1</span>: <span class="m">0</span>-Cloud                       <span class="m">2</span>: Algeria
 <span class="m">3</span>: Argentina <span class="o">(</span>La Plata<span class="o">)</span>          <span class="m">4</span>: Australia <span class="o">(</span>Canberra<span class="o">)</span>
 <span class="m">5</span>: Australia <span class="o">(</span>Melbourne<span class="o">)</span>         <span class="m">6</span>: Austria
 <span class="m">7</span>: Belgium <span class="o">(</span>Antwerp<span class="o">)</span>             <span class="m">8</span>: Belgium <span class="o">(</span>Ghent<span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
<span class="m">65</span>: Slovakia                     <span class="m">66</span>: South Africa <span class="o">(</span>Cape Town<span class="o">)</span>
<span class="m">67</span>: South Africa <span class="o">(</span>Johannesburg<span class="o">)</span>  <span class="m">68</span>: Spain <span class="o">(</span>A Coruña<span class="o">)</span>
<span class="m">69</span>: Spain <span class="o">(</span>Madrid<span class="o">)</span>               <span class="m">70</span>: Sweden
<span class="m">71</span>: Switzerland                  <span class="m">72</span>: Taiwan <span class="o">(</span>Chungli<span class="o">)</span>
<span class="m">73</span>: Taiwan <span class="o">(</span>Taipei<span class="o">)</span>              <span class="m">74</span>: Thailand
<span class="m">75</span>: Turkey <span class="o">(</span>Denizli<span class="o">)</span>             <span class="m">76</span>: Turkey <span class="o">(</span>Mersin<span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
<span class="m">93</span>: USA <span class="o">(</span>OH <span class="m">2</span><span class="o">)</span>                   <span class="m">94</span>: USA <span class="o">(</span>OR<span class="o">)</span>
<span class="m">95</span>: USA <span class="o">(</span>PA <span class="m">2</span><span class="o">)</span>                   <span class="m">96</span>: USA <span class="o">(</span>TN<span class="o">)</span>
<span class="m">97</span>: USA <span class="o">(</span>TX<span class="o">)</span>                     <span class="m">98</span>: USA <span class="o">(</span>WA<span class="o">)</span>
<span class="m">99</span>: Venezuela
Selection: <span class="m">71</span>
</code></pre></div>

<p>Finally, the package gets installed. After installing the package you can close the interactive session by typing q().</p>
<p>Do not forget to load the corresponding library (for each R session) before using functions provided by the package:</p>
<div class="codehilite"><pre><span></span><code>&gt; library<span class="o">(</span>doParallel<span class="o">)</span>
</code></pre></div>

<h3 id="batch-execution-of-r">Batch Execution of R</h3>
<p>The syntax for running R non-interactively with input read from <em>infile</em> and output send to <em>outfile</em> is:</p>
<div class="codehilite"><pre><span></span><code>R CMD BATCH <span class="o">[</span>options<span class="o">]</span> infile <span class="o">[</span>outfile<span class="o">]</span>
</code></pre></div>

<p>Suppose you placed your R code in a file called foo.R:</p>
<p><strong>foo.R</strong></p>
<div class="codehilite"><pre><span></span><code>set.seed<span class="o">(</span><span class="m">3000</span><span class="o">)</span>
valx&lt;-seq<span class="o">(</span>-2,2,0.01<span class="o">)</span>
valy&lt;-2*valx+rnorm<span class="o">(</span>length<span class="o">(</span>valx<span class="o">)</span>,0,4<span class="o">)</span>
<span class="c1"># Save plot to pdf</span>
pdf<span class="o">(</span><span class="s1">&#39;histplot.pdf&#39;</span><span class="o">)</span>
hist<span class="o">(</span>valy,prob<span class="o">=</span>TRUE,breaks<span class="o">=</span><span class="m">20</span>, <span class="nv">main</span><span class="o">=</span><span class="s2">&quot;Histogram and PDF&quot;</span>,xlab<span class="o">=</span><span class="s2">&quot;y&quot;</span>, <span class="nv">ylim</span><span class="o">=</span>c<span class="o">(</span><span class="m">0</span>,0.15<span class="o">))</span>
curve<span class="o">(</span>dnorm<span class="o">(</span>x,mean<span class="o">(</span>valy<span class="o">)</span>,sd<span class="o">(</span>valy<span class="o">))</span>,add<span class="o">=</span>T,col<span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="o">)</span>
dev.off<span class="o">()</span>
</code></pre></div>

<p>To execute foo.R on the cluster, add the R call to your job script&hellip;</p>
<p><strong>Rbatch.sh</strong></p>
<div class="codehilite"><pre><span></span><code><span class="ch">#! /bin/bash</span>
<span class="c1">#SBATCH --mail-user=&lt;put your valid email address here!&gt;</span>
<span class="c1">#SBATCH --mail-type=end,fail</span>
<span class="c1">#SBATCH --time=01:00:00</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>

<span class="c1"># Put your code below this line</span>
module load vital-it
module load R/3.4.2
R CMD BATCH --no-save --no-restore foo.R
</code></pre></div>

<p>&hellip;and submit your job script to the cluster:</p>
<div class="codehilite"><pre><span></span><code>sbatch Rbatch.sh
</code></pre></div>

<h2 id="advanced-topics">Advanced Topics</h2>
<h3 id="parallel-r">Parallel R</h3>
<p>By default, R will not make use of multiple cores available on compute nodes to parallelize computations. Parallel processing functionality is provided by add-on packages. Consider the following contrived example to get you started. To follow the example, you need the following packages installed, and the corresponding libraries loaded:</p>
<div class="codehilite"><pre><span></span><code>&gt; library<span class="o">(</span>doParallel<span class="o">)</span>
&gt; library<span class="o">(</span>foreach<span class="o">)</span>
</code></pre></div>

<p>The foreach package provides a looping construct for executing R statements repeatedly, either sequentially (similar to a for loop) or in parallel. While the binary operator %do% is used for executing the statements sequentially, the %dopar% operator is used to execute code in parallel using the currently registered backend. The getDoParWorkers() function returns the number of execution workers (cores) available in the currently registered doPar backend, by default this corresponds to one worker:</p>
<div class="codehilite"><pre><span></span><code>&gt; getDoParWorkers<span class="o">()</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">1</span>
</code></pre></div>

<p>Hence, the following R code will execute on a single core (even with the %dopar% operator):</p>
<div class="codehilite"><pre><span></span><code>&gt; start.time &lt;- Sys.time<span class="o">()</span>
&gt; foreach<span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>:1, .combine<span class="o">=</span><span class="s1">&#39;c&#39;</span>, .inorder<span class="o">=</span>FALSE<span class="o">)</span> %dopar% <span class="o">{</span>
+ Sys.sleep<span class="o">(</span><span class="m">3</span>*i<span class="o">)</span>
+ i
+ <span class="o">}</span>
end.time &lt;- Sys.time<span class="o">()</span>
exec.time &lt;- end.time - start.time
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">4</span> <span class="m">3</span> <span class="m">2</span> <span class="m">1</span>
</code></pre></div>

<p>Let&rsquo;s measure the runtime of the sequentiall execution:</p>
<div class="codehilite"><pre><span></span><code>&gt; start.time &lt;- Sys.time<span class="o">()</span><span class="p">;</span> foreach<span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>:1, .combine<span class="o">=</span><span class="s1">&#39;c&#39;</span>, .inorder<span class="o">=</span>TRUE<span class="o">)</span> %dopar% <span class="o">{</span> Sys.sleep<span class="o">(</span><span class="m">3</span>*i<span class="o">)</span><span class="p">;</span> i <span class="o">}</span><span class="p">;</span> end.time &lt;- Sys.time<span class="o">()</span><span class="p">;</span> exec.time &lt;- end.time - start.time<span class="p">;</span> exec.time
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">4</span> <span class="m">3</span> <span class="m">2</span> <span class="m">1</span>
Time difference of <span class="m">30</span>.04088 secs
</code></pre></div>

<p>Now, we will register a parallel backend to allow the %dopar% operator to execute in parallel. The doParallel package provides a parallel backend for the %dopar% operator. Let&rsquo;s find out the number of cores available on the current node</p>
<div class="codehilite"><pre><span></span><code>&gt; detectCores<span class="o">()</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">24</span>
</code></pre></div>

<p>To register the doPar backend call the function registerDoParallel(). With no arguments provided, the number of cores assigned to the backend matches the value of <em>options(&ldquo;cores&rdquo;)</em>, or if not set, to half of the cores detected by the parallel package. </p>
<div class="codehilite"><pre><span></span><code> registerDoParallel<span class="o">()</span>
&gt; getDoParWorkers<span class="o">()</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">12</span>
</code></pre></div>

<p>To assign 4 cores to the parallel backend:</p>
<div class="codehilite"><pre><span></span><code>&gt; registerDoParallel<span class="o">(</span><span class="nv">cores</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
&gt; getDoParWorkers<span class="o">()</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">4</span>
</code></pre></div>

<div class="admonition types caution">
<p class="admonition-title">Request the correct number of slots</p>
<p>Because it is crucial to request the correct number of slots for a parallel job, we propose to set the number of cores for the doPar backend to the number of slots allocated to your job:
<code>registerDoParallel(cores=Sys.getenv("SLURM_CPUS_PER_TASK"))</code></p>
</div>
<p>Now, run the example again:</p>
<div class="codehilite"><pre><span></span><code>&gt; foreach<span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>:1, .combine<span class="o">=</span><span class="s1">&#39;c&#39;</span>, .inorder<span class="o">=</span>FALSE<span class="o">)</span> %dopar% <span class="o">{</span>
+ Sys.sleep<span class="o">(</span><span class="m">3</span>*i<span class="o">)</span>
+ i
+ <span class="o">}</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">4</span> <span class="m">3</span> <span class="m">2</span> <span class="m">1</span>
</code></pre></div>

<p>Well, the output is basically the same (the results are combined in the same order!). Let&rsquo;s again measure the runtime of the parallel execution on 4 cores:</p>
<div class="admonition types caution">
<p class="admonition-title">The binary operator %do% willl always execute a foreach-loop sequentially even if registerDoParallel was called before! To correctly run a foreach in parallel, two conditions must be met:</p>
<ul>
<li>registerDoParallel() must be called with a certain number of cores</li>
<li>The %dopar% operator must be used in the foreach-loop to have it run in parallel!</li>
</ul>
</div>
<h3 id="installing-deseq2-from-bioconductor-packages">Installing DESeq2 from Bioconductor packages</h3>
<p>DESeq2<sup id="fnref:1)"><a class="footnote-ref" href="#fn:1)">1</a></sup> installed from Bioconductor<sup id="fnref:2)"><a class="footnote-ref" href="#fn:2)">2</a></sup> has many dependencies. Two odd facts are hindering a succesful build of DESeq2 in first place:</p>
<ul>
<li>data.table is needed by Hmisc, which in turn is needed by DESeq2. While Hmisc is automatically installed prior to DESeq2, data.table is not and has to be installed manually first.</li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:1)">
<p><a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">https://bioconductor.org/packages/release/bioc/html/DESeq2.html</a>&#160;<a class="footnote-backref" href="#fnref:1)" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2)">
<p><a href="https://bioconductor.org/">https://bioconductor.org/</a>&#160;<a class="footnote-backref" href="#fnref:2)" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="JupyterLab.html" title="JupyterLab" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                JupyterLab
              </span>
            </div>
          </a>
        
        
          <a href="relion.html" title="Relion" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Relion
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; University of Bern, IT Service Office
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/ubelix" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>