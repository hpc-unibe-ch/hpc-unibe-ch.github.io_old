



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Submitting jobs - HPC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/unibe.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#job-submission" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="HPC Documentation" aria-label="HPC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              HPC Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Submitting jobs
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hpc-unibe-ch/hpc-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hpc-unibe-ch/hpc-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="HPC Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    HPC Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hpc-unibe-ch/hpc-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hpc-unibe-ch/hpc-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../HOME_migration.html" title="IMPORTANT..Home Migration" class="md-nav__link">
      IMPORTANT..Home Migration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../overview_workspaces.html" title="PLAN..Workspaces" class="md-nav__link">
      PLAN..Workspaces
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quick-start.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../code-of-conduct.html" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-Started/ubelix-overview.html" title="UniBE HPC system "UBELIX"" class="md-nav__link">
      UniBE HPC system "UBELIX"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-Started/account.html" title="Accounts and Activation" class="md-nav__link">
      Accounts and Activation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-Started/login-ssh.html" title="Accessing the HPCs" class="md-nav__link">
      Accessing the HPCs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-Started/workspaces.html" title="Workspaces" class="md-nav__link">
      Workspaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-Started/ssh-customization.html" title="SSH customization" class="md-nav__link">
      SSH customization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Workspaces
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Workspaces
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hpc-workspaces/workspaces.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hpc-workspaces/management.html" title="Workspace management" class="md-nav__link">
      Workspace management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hpc-workspaces/environment.html" title="Software environment" class="md-nav__link">
      Software environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hpc-workspaces/monitoring.html" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Job handling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Job handling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Submitting jobs
      </label>
    
    <a href="submission.html" title="Submitting jobs" class="md-nav__link md-nav__link--active">
      Submitting jobs
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-allocation" class="md-nav__link">
    Resource Allocation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sbatch" class="md-nav__link">
    sbatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-script" class="md-nav__link">
    Job Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salloc" class="md-nav__link">
    salloc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srun" class="md-nav__link">
    srun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-do-i-use-srun-in-my-job-script" class="md-nav__link">
    When do I use srun in my job script?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-a-partition-queue" class="md-nav__link">
    Requesting a Partition (Queue)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-an-account" class="md-nav__link">
    Requesting an Account
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parallel-jobs" class="md-nav__link">
    Parallel Jobs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-mpi" class="md-nav__link">
    Open MPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-examples" class="md-nav__link">
    Job Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sequential-job" class="md-nav__link">
    Sequential Job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-jobs_1" class="md-nav__link">
    Parallel Jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    Performance considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-throughput" class="md-nav__link">
    Job Throughput
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-performanceruntime" class="md-nav__link">
    Job Performance/Runtime
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="monitoring-jobs.html" title="Monitoring Jobs" class="md-nav__link">
      Monitoring Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="deleting-jobs.html" title="Deleting Jobs" class="md-nav__link">
      Deleting Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="array-jobs.html" title="Array Jobs with Slurm" class="md-nav__link">
      Array Jobs with Slurm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="gpus.html" title="GPUs" class="md-nav__link">
      GPUs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="interactive-jobs.html" title="Interactive Jobs" class="md-nav__link">
      Interactive Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="investigating-job-failure.html" title="Investigating a Job Failure" class="md-nav__link">
      Investigating a Job Failure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="checkpointing.html" title="Checkpointing" class="md-nav__link">
      Checkpointing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="fair-share.html" title="Fair Share" class="md-nav__link">
      Fair Share
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../software/hpc-modules.html" title="HPC software environment" class="md-nav__link">
      HPC software environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/pre-installed-software.html" title="Pre-Installed Software" class="md-nav__link">
      Pre-Installed Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/installing-custom-software.html" title="Installing Custom Software" class="md-nav__link">
      Installing Custom Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/EasyBuild.html" title="EasyBuild" class="md-nav__link">
      EasyBuild
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-5" type="checkbox" id="nav-7-5">
    
    <label class="md-nav__link" for="nav-7-5">
      Supported Applications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-5">
        Supported Applications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../software/Anaconda.html" title="Anaconda" class="md-nav__link">
      Anaconda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/CUDA.html" title="CUDA" class="md-nav__link">
      CUDA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/JupyterLab.html" title="JupyterLab" class="md-nav__link">
      JupyterLab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/matlab.html" title="Matlab" class="md-nav__link">
      Matlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/python.html" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/r.html" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/relion.html" title="Relion" class="md-nav__link">
      Relion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/singularity.html" title="Singularity" class="md-nav__link">
      Singularity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/terminal-multiplexer-tmux.html" title="Terminal Multiplexer (tmux)" class="md-nav__link">
      Terminal Multiplexer (tmux)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Storage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../file-system/filesystem-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../file-system/quota.html" title="File System Quota" class="md-nav__link">
      File System Quota
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../file-system/file-transfer.html" title="Moving files to and from the HPCs" class="md-nav__link">
      Moving files to and from the HPCs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code-of-conduct.html" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../general/faq.html" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../halloffame.html" title="Hall of Fame" class="md-nav__link">
      Hall of Fame
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-allocation" class="md-nav__link">
    Resource Allocation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sbatch" class="md-nav__link">
    sbatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-script" class="md-nav__link">
    Job Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salloc" class="md-nav__link">
    salloc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srun" class="md-nav__link">
    srun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-do-i-use-srun-in-my-job-script" class="md-nav__link">
    When do I use srun in my job script?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-a-partition-queue" class="md-nav__link">
    Requesting a Partition (Queue)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-an-account" class="md-nav__link">
    Requesting an Account
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parallel-jobs" class="md-nav__link">
    Parallel Jobs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-mpi" class="md-nav__link">
    Open MPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-examples" class="md-nav__link">
    Job Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sequential-job" class="md-nav__link">
    Sequential Job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-jobs_1" class="md-nav__link">
    Parallel Jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    Performance considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-throughput" class="md-nav__link">
    Job Throughput
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-performanceruntime" class="md-nav__link">
    Job Performance/Runtime
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="job-submission">Job Submission</h1>
<h2 id="description">Description</h2>
<p>This section describes the interaction with the resource manager. The subchapters contain information about submitting jobs to the cluster, monitoring active jobs and retrieving useful information about resource usage.</p>
<p>A cluster is a set of connected computers that work together to solve computational tasks (user jobs) and presents itself to the user as a single system. For the resources of a cluster (e.g. CPUs, GPUs, memory) to be used efficiently, a resource manager (also called workload manager or batch-queuing system) is vital. While there are many different resource managers available, the resource manager of choice on UBELIX is <a href="https://slurm.schedmd.com">SLURM</a>. After submitting a job to the cluster, SLURM will try to fulfill the job&rsquo;s resource request by allocating resources to the job. If the requested resources are already available, the job can start immediately. Otherwise, the start of the job is delayed (pending) until enough resources are available. SLURM allows you to monitor active (pending, running) jobs and to retrieve statistics about finished jobs e.g. (peak CPU usage). The subchapters describe individual aspects of SLURM.</p>
<p>This page describes the job submission process with Slurm.</p>
<div class="admonition types caution">
<p>It is important to collect error/output messages either by writing such information to the default location or by specifying specific locations using the <code>--error</code>/<code>-–output</code> option. Do not redirect the error/output stream to /dev/null unless you know what you are doing. Error and output messages are the starting point for investigating a job failure.</p>
</div>
<div class="admonition types caution">
<p>For backfilling performance and hence to maximize job throughput it is crucial to submit array jobs (collection of similar jobs) instead of submitting the same job repeatedly.</p>
</div>
<h2 id="resource-allocation">Resource Allocation</h2>
<p>Every job submission starts with a resources allocation (nodes, cores, memory). An allocation is valid for a specific amount of time, and can be created using the salloc, sbatch or srun commands. Whereas salloc and sbatch only create resource allocations, srun launches parallel tasks within such a resource allocation, or implicitly creates an allocation if not started within one. <strong>The usual procedure is to combine resource requests and task execution (job steps) in a single batch script (job script) and then submit the script using the sbatch command.</strong></p>
<div class="admonition types note">
<p>Most command options support a short form as well as a long form (e.g. <code>-u &lt;username&gt;</code>, and <code>--user=&lt;username&gt;</code>). Because few options only support the long form, we will consistently use the long form throughout this documentation.</p>
</div>
<div class="admonition types note">
<p>Some options have default values if not specified: The <code>--time</code> option has partition-specific default values (see <code>scontrol show partition &lt;partname&gt;</code>). The <code>--mem-per-cpu</code> option has a global default value of 2048MB.</p>
</div>
<div class="admonition types note">
<p>The default partition is the <em>all</em> partition. To select another partition one must use the <code>--partition</code> option, e.g. <code>--partition=long</code>.</p>
</div>
<div class="admonition types caution">
<p class="admonition-title">Important information for investors regarding account selection</p>
<p>Investors have two different accounts for accounting purposes. The investor account (increased privileges) is used automatically when using the <code>empi</code> partition (<code>--partition=empi</code>). To use another partition, the user must explicitly select the group account (e.g <code>--account=dcb</code>). To display your accounts, use: <code>sacctmgr show assoc where user=&lt;username&gt; format=user,account%20,partition</code>.</p>
</div>
<h3 id="sbatch">sbatch</h3>
<p>The <code>sbatch</code> command is used to submit a job script for later execution. It is the most common way to submit a job to the cluster due to its reusability. Slurm options are usually embedded in a job script prefixed by &lsquo;#SBATCH&rsquo; directives. Slurm options specified as command line options overwrite corresponding options embedded in the job script</p>
<p>Syntax</p>
<div class="codehilite"><pre><span></span><code>sbatch <span class="o">[</span>options<span class="o">]</span> script <span class="o">[</span>args...<span class="o">]</span>
</code></pre></div>

<h3 id="job-script"><small><strong>Job Script</strong></small></h3>
<p>Usually a job script consists of two parts. The first part is optional but highly recommended:</p>
<ul>
<li>Slurm-specific options used by the scheduler to manage the resources (e.g. memory) and configure the job environment</li>
<li>Job-specific shell commands</li>
</ul>
<p>The job script acts as a wrapper for your actual job. Command-line options can still be used to overwrite embedded options.</p>
<div class="admonition types note">
<p>Although you can specify all Slurm options on the command-line, we encourage you, for clarity and reusability, to embed Slurm options in the job script</p>
</div>
<div class="admonition types note">
<p>You can find a template for a job script under <code>/storage/software/workshop/slurm_template.sh</code>. Copy the template to your home directory and adapt it to your needs: <code>cp /gpfs/software/workshop/job_script_template.sh $HOME</code></p>
</div>
<h3 id="options"><small><strong>Options</strong></small></h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Example</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--mail-user</code></td>
<td>Mail address to contact job owner. <strong>Must specify a valid email address!</strong></td>
<td><code>--mail-user=foo.bar@baz.unibe.ch</code></td>
<td></td>
</tr>
<tr>
<td><code>--mail-type</code></td>
<td>When to notify a job owner: <em>none, all, begin, end, fail, requeue, array_tasks</em></td>
<td><code>--mail-type=end,fail</code></td>
<td></td>
</tr>
<tr>
<td><code>--account</code></td>
<td>Which account to charge. Regular users don&rsquo;t need to specify this option. For users with enhanced privileges on the <em>empi</em> partition, see <a href="https://docs.id.unibe.ch/ubelix/job-management-with-slurm/job-submission#JobSubmission-RequestinganAccount">here</a></td>
<td></td>
<td>The users default account.</td>
</tr>
<tr>
<td><code>--job-name</code></td>
<td>Specify a job name</td>
<td><code>--job-name="Simple Matlab"</code></td>
<td></td>
</tr>
<tr>
<td><code>--time</code></td>
<td>Expected runtime of the job. Format: dd-hh:mm:ss</td>
<td><code>--time=12:00:00</code> <br> <code>--time=2-06:00:00</code></td>
<td>Partition-specific, see <code>scontrol show partition &lt;partname&gt;</code></td>
</tr>
<tr>
<td><code>--mem-per-cpu</code></td>
<td>Minimum memory required per allocated CPU in megabytes. Different units can be specified using the suffix [K|M|G]</td>
<td><code>--mem-per-cpu=2G</code></td>
<td>2048 MB</td>
</tr>
<tr>
<td><code>--tmp</code></td>
<td>Specify the amount of disk space that must be available on the compute node(s). The local scratch space for the job is referenced by the variable <code>$TMPDIR</code>. Default units are megabytes. Different units can be specified using the suffix [K|M|G|T].</td>
<td><code>--tmp=8G</code> <br><code>--tmp=2048</code></td>
<td></td>
</tr>
<tr>
<td><code>--ntasks</code></td>
<td>Number of tasks (processes). Used for MPI jobs that may run distributed on multiple compute nodes</td>
<td><code>--ntasks=4</code></td>
<td>1 or to match <code>--nodes</code>, <code>--tasks-per-node</code> if specified</td>
</tr>
<tr>
<td><code>--nodes</code></td>
<td>Request a certain number of nodes</td>
<td><code>--nodes=2</code></td>
<td>1 or to match <code>--ntasks</code>, <code>--tasks-per-node</code> if specified</td>
</tr>
<tr>
<td><code>--ntasks-per-node</code></td>
<td>Specifies how many tasks will run on each allocated node. Meant to be used with <code>--nodes</code>. If used with the <code>--ntasks</code> option, the <code>--ntasks</code> option will take precedence and the <code>--ntasks-per-node</code> will be treated as a maximum count of tasks per node.</td>
<td><code>--ntasks-per-node=2</code></td>
<td></td>
</tr>
<tr>
<td><code>--cpus-per-task</code></td>
<td>Number of CPUs per taks (threads). Used for shared memory jobs that run locally on a single compute node</td>
<td><code>--cpus-per-task=4</code></td>
<td>1</td>
</tr>
<tr>
<td><code>--array</code></td>
<td>Submit an array job. Use &ldquo;%&rdquo; to specify the max number of tasks allowed to run concurrently.</td>
<td><code>--array=1,4,16-32:4</code> <br> <code>--array=1-100%20</code></td>
<td></td>
</tr>
<tr>
<td><code>--workdir</code></td>
<td>Set the current working directory. All relative paths used in the job script are relative to this directory</td>
<td></td>
<td>The directory from where the sbatch command was executed</td>
</tr>
<tr>
<td><code>--output</code></td>
<td>Redirect standard output. <strong>All directories specified in the path must exist before the job starts!</strong></td>
<td></td>
<td>By default stderr and stdout are connected to the same file slurm-%j.out, where &lsquo;%j&rsquo; is replaced with the job allocation number.</td>
</tr>
<tr>
<td><code>--error</code></td>
<td>Redirect standard error. <strong>All directories specified in the path must exist before the job starts!</strong></td>
<td></td>
<td>By default stderr and stdout are connected to the same file slurm-%j.out, where &lsquo;%j&rsquo; is replaced with the job allocation number.</td>
</tr>
<tr>
<td><code>--partition</code></td>
<td><strong>The &ldquo;all&rdquo; partition is the default partition. A different partition must be requested with the <code>--partition</code> option!</strong></td>
<td><code>--partition=long</code> <br> <code>--partition=debug</code></td>
<td>Default partition: all</td>
</tr>
<tr>
<td><code>--dependency</code></td>
<td>Defer the start of this job until the specified dependencies have been satisfied. See <code>man sbatch</code> for a description of all valid dependency types</td>
<td><code>--dependency=afterany:11908</code></td>
<td></td>
</tr>
<tr>
<td><code>--hold</code></td>
<td>Submit job in hold state. Job is not allowed to run until explicitly released</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>--immediate</code></td>
<td>Only submit the job if all requested resources are immediately available</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>--exclusive</code></td>
<td>Use the compute node(s) exclusively, i.e. do not share nodes with other jobs. <strong>CAUTION: Only use this option if you are an experienced user, and you really understand the implications of this feature. If used improperly, the use of this option can lead to a massive waste of computational resources</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>--constraint</code></td>
<td>Request nodes with certain features. This option allows you to request a homogeneous pool of nodes for you MPI job</td>
<td><code>--constraint=ivy</code> (all, long partition) <br> <code>--constraint=sandy</code> (all partition only) <br> <code>--constraint=broadwell</code> (all, empi partition)</td>
<td></td>
</tr>
<tr>
<td><code>--parsable</code></td>
<td>Print the job id only</td>
<td></td>
<td>Default output: &ldquo;<code>Submitted batch job &lt;jobid&gt;</code>&ldquo;</td>
</tr>
<tr>
<td><code>--test-only</code></td>
<td>Validate the batch script and return the estimated start time considering the current cluster state</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="example"><small><strong>Example</strong></small></h3>
<p>jobs.sh
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-type=none</span>
<span class="c1">#SBATCH --job-name=&quot;Serial example&quot;</span>
<span class="c1">#SBATCH --time=00:10:00</span>
<span class="c1">#SBATCH --mem-per-cpu=4G</span>

<span class="c1"># Your code below this line</span>
./calc_mat.sh
</code></pre></div></p>
<p>Submit the job script:</p>
<div class="codehilite"><pre><span></span><code>sbatch job.sh
Submitted batch job 30215045
</code></pre></div>

<div class="admonition types note">
<p>See below for more examples</p>
</div>
<h3 id="salloc"><small><strong>salloc</strong></small></h3>
<p>The <code>salloc</code> command is used to allocate resources (e.g. nodes), possibly with a set of constraints (e.g. number of processor per node) for later utilization. It is typically used to allocate resources and spawn a shell, in which the <code>srun</code> command is used to launch parallel tasks.</p>
<p>Syntax
<div class="codehilite"><pre><span></span><code>salloc <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>&lt;command&gt; <span class="o">[</span>args...<span class="o">]]</span>
</code></pre></div></p>
<p>Example
<div class="codehilite"><pre><span></span><code>bash$ salloc -N <span class="m">2</span> sh
salloc: Granted job allocation <span class="m">247</span>
sh$ module load openmpi/1.10.2-gcc
sh$ srun --mpi<span class="o">=</span>pmi2 mpi_hello_world
Hello, World.  I am <span class="m">1</span> of <span class="m">2</span> running on knlnode03.ubelix.unibe.ch
Hello, World.  I am <span class="m">0</span> of <span class="m">2</span> running on knlnode02.ubelix.unibe.ch
sh$ <span class="nb">exit</span>
salloc: Relinquishing job allocation <span class="m">247</span>
</code></pre></div></p>
<h3 id="srun"><small><strong>srun</strong></small></h3>
<p>The <code>srun</code> command creates job steps. One or multiple <code>srun</code> invocations are usually used from within an existing resource allocation. Thereby, a job step can utilize all resources allocated to the job, or utilize only a subset of the resource allocation. Multiple job steps can run sequentially in the order defined in the batch script or run in parallel, but can together never utilize more resources than provided by the allocation.</p>
<div class="admonition types danger">
<p>Do not submit a job script using <code>srun</code>. Embedded Slurm options (<code>#SBATCH</code>) are not parsed by <code>srun</code>.</p>
</div>
<p>Syntax
<div class="codehilite"><pre><span></span><code>srun [options] executable [args...]
</code></pre></div></p>
<h3 id="when-do-i-use-srun-in-my-job-script"><small><strong>When do I use srun in my job script?</strong></small></h3>
<p>Use <code>srun</code> in your job script to</p>
<ul>
<li>start MPI tasks</li>
<li>run multiple jobs (serial or parallel jobs) simultaneously within an allocation</li>
</ul>
<p><strong>Example</strong>
Run MPI task:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-type=none</span>
<span class="c1">#SBATCH --job-name=&quot;Open MPI example&quot;</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=16</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>
<span class="c1">#SBATCH --time=06:00:00</span>

<span class="c1"># Your code below this line</span>
module load openmpi/1.10.2-gcc
srun --mpi<span class="o">=</span>pmi2 mpi_bin
</code></pre></div>

<p>Run two jobs simultaneously:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-type=none</span>
<span class="c1">#SBATCH --job-name=&quot;Open MPI example&quot;</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=2</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>
<span class="c1">#SBATCH --time=06:00:00</span>

<span class="c1"># Your code below this line</span>
<span class="c1"># Each job should run on a different node and starts two processes on that node:</span>
srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">2</span> job01.sh <span class="p">&amp;</span>
srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">2</span> job02.sh <span class="p">&amp;</span>
<span class="c1"># Wait for both commands to finish. This is important when running bash commands in the background (using &amp;)!</span>
<span class="nb">wait</span>
</code></pre></div>

<h2 id="requesting-a-partition-queue">Requesting a Partition (Queue)</h2>
<p>The default partition is the &lsquo;all&rsquo; partition. If you do not explicitly request a partition, your job will run in the default partition. To request a different partition, you must use the <code>--partition</code> option:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#SBATCH --partition=long</span>
</code></pre></div>

<p>See <a href="../getting-Started/ubelix-overview.html#cluster-partitions-queues-and-their-compute-nodes">here</a>  for a list of availalble partitions.</p>
<h2 id="requesting-an-account">Requesting an Account</h2>
<p>Accounts are used for accounting purposes. Every user has a default account that is used unless a different account is specified using the <code>--account</code> option. Regular users only have a single account and can thus not request a different account. The default account for regular user is named after their group (e.g. dcb):</p>
<div class="codehilite"><pre><span></span><code>$ sacctmgr show user foo
      User   Def Acct     Admin
---------- ---------- ---------
       foo        bar      None
</code></pre></div>

<div class="admonition type note">
<p>The remaining information provided in this section applies only to users with enhanced privileges on the <code>empi</code> partition.</p>
</div>
<p>Users with enhanced privileges have an additional account for the <code>empi</code> partition. This additional account is set as their default account, which means they don&rsquo;t have to specify an account when submitting to the <code>empi</code> partition (<code>--partition=empi</code>), but must specify their &ldquo;group account&rdquo; (<code>--account=&lt;group&gt;</code>) for submitting to any other partition (e.g <code>all</code>). If a wrong account/partition combination is requested, you will experience the following error message:</p>
<div class="codehilite"><pre><span></span><code>sbatch: error: Batch job submission failed: Invalid account or account/partition combination specified
</code></pre></div>

<h3 id="example_1"><small><strong>Example</strong></small></h3>
<p>Here are some examples on the usage of the <code>--account</code> and <code>--partition</code> options.</p>
<p>Regular users:</p>
<div class="codehilite"><pre><span></span><code>Submit to the <span class="s2">&quot;all&quot;</span> partition:
No options required!

Submit to any other partition:
--partition<span class="o">=</span>&lt;partname&gt; e.g. --partition<span class="o">=</span>empi
</code></pre></div>

<p>Users with enhanced privileges on the <code>empi</code> partition:</p>
<div class="codehilite"><pre><span></span><code>Submit to the <span class="s2">&quot;all&quot;</span> partition:
--account<span class="o">=</span>&lt;grpname&gt; e.g. --account<span class="o">=</span>dcb

Submit to the <span class="s2">&quot;empi&quot;</span> partition:
--partition<span class="o">=</span>empi

Submit to any other partition:
--account<span class="o">=</span>&lt;grpname&gt; e.g. --account<span class="o">=</span>dcb
--partition<span class="o">=</span>&lt;partname&gt; e.g. --partition<span class="o">=</span>long
</code></pre></div>

<h2 id="parallel-jobs">Parallel Jobs</h2>
<p>A parallel job either runs on multiple CPU cores on a single compute node, or on multiple CPU cores distributed over multiple compute nodes. With Slurm you can request tasks, and CPUs per task. A task corresponds to a process that may be made up of multiple threads (CPUs per task). Different tasks of a job allocation may run on different compute nodes, while all threads that belong to a certain process execute on the same node. <strong>For shared memory jobs (SMP, parallel jobs that run on a single compute node) one would request a single task and a certain number of CPUs for that task:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">#SBATCH --cpus-per-task=16</span>
</code></pre></div>

<p><strong>For MPI jobs (parallel jobs that may be distributed over multiple compute nodes) one would request a certain number of tasks and certain number of nodes:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=16</span>
</code></pre></div>

<div class="admonition type danger">
<p>The requested node,task, and CPU resources must match! For example, you cannot request one node (<code>--nodes=1</code>) and more tasks (<code>--ntasks-per-node</code>) than CPU cores are available on a single node in the partition. In such a case you will experience an error message: <strong>sbatch: error: Batch job submission failed: Requested node configuration is not available.</strong></p>
</div>
<h3 id="open-mpi"><small><strong>Open MPI</strong></small></h3>
<p>Open MPI was compiled with Slurm support, which means that you do not have to specify the number of processes and the execution hosts using the <code>-np</code> and the <code>-hostfile</code> options. Slurm will automatically provide this information to mpirun based on the allocated tasks:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-user=foo.bar@baz.unibe.ch</span>
<span class="o">(</span>...<span class="o">)</span>
<span class="c1">#SBATCH --nodes=4</span>
<span class="c1">#SBATCH --ntasks-per-node=16</span>

module load openmpi/1.10.2-gcc
mpirun &lt;options&gt; &lt;binary&gt;
</code></pre></div>

<h2 id="environment-variables">Environment Variables</h2>
<p>Slurm sets various environment variables available in the context of the job script. Some are set based on the requested resources for the job.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Set By Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SLURM_JOB_NAME</code></td>
<td><code>--job-name</code></td>
<td>Name of the job</td>
</tr>
<tr>
<td><code>SLURM_ARRAY_JOB_ID</code></td>
<td></td>
<td>ID of your job</td>
</tr>
<tr>
<td><code>SLURM_ARRAY_TASK_ID</code></td>
<td><code>--array</code></td>
<td>ID of the current array task</td>
</tr>
<tr>
<td><code>SLURM_ARRAY_TASK_MAX</code></td>
<td><code>--array</code></td>
<td>Job array&rsquo;s maximum ID (index) number</td>
</tr>
<tr>
<td><code>SLURM_ARRAY_TASK_MIN</code></td>
<td><code>--array</code></td>
<td>Job array&rsquo;s minimum ID (index) number</td>
</tr>
<tr>
<td><code>SLURM_ARRAY_TASK_STEP</code></td>
<td><code>--array</code></td>
<td>Job array&rsquo;s index step size</td>
</tr>
<tr>
<td><code>SLURM_NTASKS</code></td>
<td><code>--ntasks</code></td>
<td>Same as <code>-n</code>, <code>--ntasks</code></td>
</tr>
<tr>
<td><code>SLURM_NTASKS_PER_NODE</code></td>
<td><code>--ntasks-per-node</code></td>
<td>Number of tasks requested per node.  Only set if the <code>--ntasks-per-node</code> option is specified</td>
</tr>
<tr>
<td><code>SLURM_CPUS_PER_TASK</code></td>
<td><code>--cpus-per-task</code></td>
<td>Number of cpus requested per task.  Only set if the <code>--cpus-per-task</code> option is specified</td>
</tr>
<tr>
<td><code>TMPDIR</code></td>
<td></td>
<td>References the disk space for the job on the local scratch</td>
</tr>
</tbody>
</table>
<h2 id="job-examples">Job Examples</h2>
<h3 id="sequential-job">Sequential Job</h3>
<p>Running a Single Job Step</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-user=foo.bar@baz.unibe.ch</span>
<span class="c1">#SBATCH --mail-type=end,fail</span>
<span class="c1">#SBATCH --job-name=&quot;Serial Job&quot;</span>
<span class="c1">#SBATCH --time=04:00:00</span>

<span class="c1"># Your code below this line</span>
<span class="nb">echo</span> <span class="s2">&quot;I&#39;m on host:&quot;</span>
hostname
<span class="nb">echo</span> <span class="s2">&quot;Environment variables:&quot;</span>
env
</code></pre></div>

<h3 id="parallel-jobs_1"><small><strong>Parallel Jobs</strong></small></h3>
<p><strong>Shared Memory Jobs (e.g. OpenMP)</strong></p>
<p>SMP parallelization is based upon dynamically created threads (fork and join) that share memory on a single node. The key request is <code>--cpus-per-task</code>. To run N threads in parallel, we request N CPUs on the node (<code>--cpus-per-task=N</code>). OpenMP is not slurm-aware, you need to specify <code>export OMP_NUM_THREADS=...</code> in your submission script! Thereby OMP_NUM_THREADS (max number of thread spawned by your program) must correspond the number of cores requested. As an example, consider the following job script:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-user=foo.bar@baz.unibe.ch</span>
<span class="c1">#SBATCH --mail-type=end,fail</span>
<span class="c1">#SBATCH --job-name=&quot;SMP Job&quot;</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>
<span class="c1">#SBATCH --cpus-per-task=16</span>
<span class="c1">#SBATCH --time=04:00:00</span>

<span class="c1"># Your code below this line</span>
<span class="c1"># set OMP_NUM_THREADS to the number of --cpus-per-task that we requested</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="nv">$SLURM_CPUS_PER_TASK</span>
./my_binary
</code></pre></div>

<div class="admonition type danger">
<p>For optimal resource management, notably to prevent oversubscribing the compute node, setting the correct number of threads is crucial. The assignment <code>OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK</code> will ensure that your program does not spawn more threads than requested.</p>
</div>
<p><strong>MPI Jobs (e.g. Open MPI)</strong></p>
<p>MPI parallelization is based upon processes (local or distributed) that communicate by passing messages. Since they don&rsquo;t rely on shared memory those processes can be distributed among several compute nodes.
Use the option <code>--ntasks</code> to request a certain number of tasks (processes) that can be distributed over multiple nodes:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-user=foo.bar@baz.unibe.ch</span>
<span class="c1">#SBATCH --mail-type=end</span>
<span class="c1">#SBATCH --job-name=&quot;MPI Job&quot;</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>
<span class="c1">#SBATCH --ntasks=8</span>
<span class="c1">#SBATCH --time=04:00:00</span>

<span class="c1"># Your code below this line</span>
<span class="c1"># First set the environment for using Open MPI</span>
module load openmpi/1.10.2-gcc
srun --mpi<span class="o">=</span>pmi2 ./my_binary <span class="c1"># or, mpirun ./my_binary</span>
</code></pre></div>

<p>On the &lsquo;empi&rsquo; partition you must use all CPUs provided by a node (20 CPUs). For example to run an OMPI job on 80 CPUs, do:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --mail-user=foo.bar@baz.unibe.ch</span>
<span class="c1">#SBATCH --mail-type=end,fail</span>
<span class="c1">#SBATCH --job-name=&quot;MPI Job&quot;</span>
<span class="c1">#SBATCH --mem-per-cpu=2G</span>
<span class="c1">#SBATCH --nodes=4</span>
<span class="c1">#SBATCH --ntasks-per-node=20</span>
<span class="c1">#SBATCH --time=12:00:00</span>

<span class="c1"># Your code below this line</span>
<span class="c1"># First set the environment for using Open MPI</span>
module load openmpi/1.10.2-gcc
srun --mpi<span class="o">=</span>pmi2 ./my_binary <span class="c1"># or, mpirun ./my_binary</span>
</code></pre></div>

<h2 id="performance-considerations">Performance considerations</h2>
<h3 id="job-throughput">Job Throughput</h3>
<p><strong>It is crucial to specify a more or less accurate runtime for your job.</strong><br />
Requesting too little will result in job abortion, while requesting too much will have a negative impact on job start time and job throughput: Firstly, jobs with a shorter runtime have a greater chance to benefit from being backfilled between long running jobs and may therefore start earlier if resources are scarce. Secondly, a short running job may still start when a scheduled downtime is getting closer while long running jobs won&rsquo;t start because they are not guaranteed to finish before the start of the downtime.</p>
<p><strong>It is crucial to request the correct amount of cores for your job.</strong><br />
Requesting cores that your job cannot utilize is a waste of resources that could otherwise be allocated to other jobs. Hence, jobs that theoretically could run have to wait for the resources to become available. For potential consequences of requesting too less cores on job performance, see below.</p>
<p><strong>It is crucial to request the correct amount of memory for your job.</strong><br />
Requesting too little memory will result in job abortion. Requesting too much memory is a waste of resources that could otherwise be allocated to other jobs.</p>
<h3 id="job-performanceruntime">Job Performance/Runtime</h3>
<p><strong>It is crucial to request the correct amount of cores for your job.</strong><br />
For parallel jobs (shared memory, MPI, hybrid) requesting less cores than processes/threads are spawned by the job will lead to potentially overbooked compute nodes. This is because your job will nevertheless spawn the required number of processes/threads (use a certain number of cores) while to the scheduler it appears that some of the utilized resources are still available, and thus the scheduler will allocate those resources to other jobs. Although under certain circumstances it might make sense to share cores among multiple processes/threads, the above reasoning should be considered as a general guideline, especially for unexperienced user.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../hpc-workspaces/monitoring.html" title="Monitoring" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Monitoring
              </span>
            </div>
          </a>
        
        
          <a href="monitoring-jobs.html" title="Monitoring Jobs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Monitoring Jobs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; University of Bern, IT Service Office
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/ubelix" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>